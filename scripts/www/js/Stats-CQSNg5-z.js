import{_ as w,b as $,a as O,u as F,g as R,m as B}from"./index-Bwo_eupb.js";import{_ as D}from"./Header-DPsxo2p6.js";import{i as E,j as f,w as b,J as k,P as I,f as u,o as d,g as t,Q as L,l as S,k as M,t as h,F as x,r as P,R as U}from"./vendor-CLLCb1yY.js";import{O as W}from"./Overlay-C3FDQmZs.js";const j={class:"pie-chart-container"},N={__name:"PieChart",props:{data:{type:Array,required:!0,default:()=>[]}},setup(y){const l=y,i=E(null),v=$();let s=null,c=null;const p=["#ffd10a","#587bf3","#0db8f5","#b6d634","#585b7d","#ff6b98","#785db0","#ff994d"];f(()=>l.data.reduce((a,n)=>a+n.amount,0));const m=f(()=>l.data.map((a,n)=>({name:a.category,value:a.amount,percentage:a.percentage,itemStyle:{color:p[n%p.length]}})));function _(){const a=v.isDark;return{tooltip:{trigger:"item",formatter:"{b}: ¥{c}"},legend:{type:"scroll",bottom:"0%",left:"center",textStyle:{fontSize:13,color:a?"rgba(255, 255, 255, 0.9)":"#2c2c2c"},formatter:n=>{const g=l.data.find(C=>C.category===n),z=g?g.percentage.toFixed(1):0;return`${n} ${z}%`}},series:[{type:"pie",radius:["50%","70%"],avoidLabelOverlap:!0,center:["50%","45%"],itemStyle:{borderColor:"#ffffff",borderWidth:1,borderRadius:10},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:40,fontWeight:"bold",formatter:function(n){return`{nameStyle|${n.name}}
{valueStyle|${n.percent.toFixed(1)}%}`},rich:{nameStyle:{fontSize:20,color:"#333",fontWeight:"bold",lineHeight:36},valueStyle:{fontSize:22,color:"#666",marginTop:8}}}},labelLine:{show:!1},data:m.value}],animationDuration:1500,animationEasing:"cubicOut"}}function o(){i.value&&(s=L(i.value),s.setOption(_()))}function e(){s&&(s.clear(),s.setOption(_()))}function r(){s&&s.resize()}return b(()=>v.theme,()=>{e()}),b(()=>l.data,()=>{e()},{deep:!0}),k(()=>{o(),c=new ResizeObserver(()=>{s&&s.resize()}),i.value&&c.observe(i.value),window.addEventListener("resize",r)}),I(()=>{s&&s.dispose(),c&&i.value&&(c.unobserve(i.value),c.disconnect()),window.removeEventListener("resize",r)}),(a,n)=>(d(),u("div",j,[t("div",{ref_key:"chartRef",ref:i,class:"chart-wrapper"},null,512)]))}},T=w(N,[["__scopeId","data-v-fa4c3eba"]]),V={class:"page fade-in-up"},q={class:"container"},A={class:"glass-card"},H={class:"section-header"},J={class:"section-title",style:{"font-size":"14px"}},Q={key:1,class:"empty-state"},Y={class:"glass-card",style:{"margin-top":"24px"}},G={key:0},K={class:"stat-bar-header"},X={class:"stat-bar-label"},Z={class:"stat-bar-value"},ee={class:"stat-bar-track"},te={key:1,class:"empty-state"},se={class:"glass-card",style:{"margin-top":"24px"}},ae={class:"tips-text"},oe={__name:"Stats",setup(y){const l=O(),i=F(),v=f(()=>l.loading);k(async()=>{const o=new Date,e=o.getFullYear(),r=o.getMonth(),n=R("backupSettings",{}).cloudBackup;if(i.userId&&n)try{await l.fetchMonthlyRecords(i.userId,e,r)}catch(g){console.error("加载本月统计数据失败:",g),B.error("加载记录失败",g.message)}});const s=f(()=>l.totalExpense),c=f(()=>{const o=l.expenseByCategory,e=s.value;return Object.entries(o).map(([r,a])=>({category:r,amount:a,percentage:e>0?a/e*100:0})).sort((r,a)=>a.amount-r.amount)}),p=["#ffd10a","#587bf3","#0db8f5","#b6d634","#585b7d","#ff6b98","#785db0","#ff994d"];function m(o){return p[o%p.length]}const _=f(()=>{if(c.value.length===0)return"开始记录你的每一笔支出，养成良好的理财习惯！";const o=c.value[0],e=o.percentage;return e>50?`本月${o.category}支出占比最高（${e.toFixed(0)}%），建议适当控制，合理分配支出。`:e>30?`本月${o.category}支出较多（${e.toFixed(0)}%），可以尝试寻找更经济实惠的替代方案。`:"支出分布比较均衡，继续保持良好的消费习惯！"});return(o,e)=>(d(),u(x,null,[t("div",V,[S(D,{title:"财务统计"}),t("div",q,[t("div",A,[t("div",H,[e[0]||(e[0]=t("div",{class:"section-title"},"本月支出占比",-1)),t("div",J,"总支出:  ¥ "+h(s.value.toFixed(2)),1)]),s.value>0?(d(),M(T,{key:0,data:c.value},null,8,["data"])):(d(),u("div",Q,[...e[1]||(e[1]=[t("p",null,"本月暂无支出记录",-1)])]))]),t("div",Y,[e[3]||(e[3]=t("div",{class:"section-header"},[t("div",{class:"section-title"},"本月支出详情")],-1)),s.value>0?(d(),u("div",G,[(d(!0),u(x,null,P(c.value,(r,a)=>(d(),u("div",{key:r.category,class:"stat-bar-item"},[t("div",K,[t("span",X,h(r.category),1),t("span",Z,"¥"+h(r.amount.toFixed(2)),1)]),t("div",ee,[t("div",{class:"stat-bar-fill",style:U({width:r.percentage+"%",background:m(a)})},null,4)])]))),128))])):(d(),u("div",te,[...e[2]||(e[2]=[t("p",null,"本月暂无支出记录",-1)])]))]),t("div",se,[e[4]||(e[4]=t("div",{class:"section-header"},[t("div",{class:"section-title"},"理财小贴士")],-1)),t("p",ae,h(_.value),1)])])]),S(W,{show:v.value},null,8,["show"])],64))}},le=w(oe,[["__scopeId","data-v-82fcc1e9"]]);export{le as default};
