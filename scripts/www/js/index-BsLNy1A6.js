const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Welcome-Dm_9zxW7.js","./vendor-CLLCb1yY.js","../css/vendor-DweQxG6p.css","../css/Welcome-CodzITDE.css","./Auth-zIeC9KMu.js","../css/Auth-UhbO-IEn.css","./Home-m0Xb91A0.js","./Header-Bt5F6yjk.js","./TransactionItem-B9TJhCCc.js","../css/TransactionItem-DCwIdHFx.css","./Overlay-B0sPJSDj.js","../css/Overlay-DHeRTWvF.css","../css/Home-CgsOo5LI.css","./Calendar-DYQO07XY.js","../css/Calendar-BZxahGYO.css","./Stats-DYliK8Ld.js","../css/Stats-BOaho8rR.css","./Settings-r_90gDqm.js","./version-GmJQqd8X.js","../css/Settings-Du4_IoJ9.css","./Profile-DRNvsc_Q.js","./FormSection-dfhb-kCF.js","../css/FormSection-DCLoU9gX.css","./BackNavBar-B1Wem3l3.js","../css/BackNavBar-CxT89gi2.css","../css/Profile-B4cUGDV0.css","./FieldEditPage-C25xnP9y.js","../css/FieldEditPage-DmtWIo2D.css","./Backup-ZMfWN3q1.js","../css/Backup-DZLVosV6.css","./AppUpdate-C0bJ2b83.js","../css/AppUpdate-DuraFSjD.css","./UserAgreement-CiIVAMm9.js","../css/UserAgreement-CuaIzKCG.css","./PrivacyPolicy-DfrkW699.js","../css/PrivacyPolicy-Uq6usea-.css"])))=>i.map(i=>d[i]);
import{d as Z,c as _e,a as Se,b as De,u as Ee,e as pe,w as W,f as v,o as f,g as i,F as A,r as U,n as R,h as P,i as z,j as I,k as j,l as V,m as q,p as L,t as T,q as ee,T as fe,s as te,v as G,x as K,y as ge,z as ye,A as ke,U as Me,B as X,C as Pe,D as Ie,E as Ve,G as xe,H as ze,I as se,J as Ce,K as Re,L as Te}from"./vendor-CLLCb1yY.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(o){if(o.ep)return;o.ep=!0;const n=r(o);fetch(o.href,n)}})();const F="bookkeeping_";function Q(t,e=null){try{const r=localStorage.getItem(F+t);return r?JSON.parse(r):e}catch(r){return console.error("Error reading from localStorage:",r),e}}function $(t,e){try{return localStorage.setItem(F+t,JSON.stringify(e)),!0}catch(r){return console.error("Error writing to localStorage:",r),!1}}function Le(t){try{return localStorage.removeItem(F+t),!0}catch(e){return console.error("Error removing from localStorage:",e),!1}}function hr(){try{return Object.keys(localStorage).forEach(e=>{e.startsWith(F)&&localStorage.removeItem(e)}),!0}catch(t){return console.error("Error clearing localStorage:",t),!1}}const re=Z("ui",{state:()=>{const t=Q("userProfile",{});return{theme:Q("theme","light"),currentTab:"home",isModalOpen:!1,modalType:"expense",editingRecord:null,defaultCategory:null,userAvatar:(t==null?void 0:t.avatar)||""}},getters:{isDark:t=>t.theme==="dark"},actions:{toggleTheme(){this.theme=this.theme==="light"?"dark":"light",this.applyTheme(),$("theme",this.theme)},setTheme(t){this.theme=t,this.applyTheme(),$("theme",this.theme)},applyTheme(){document.documentElement.setAttribute("data-theme",this.theme)},initTheme(){this.applyTheme()},setCurrentTab(t){this.currentTab=t},openModal(t="expense",e=null){this.modalType=t,this.defaultCategory=e,this.editingRecord=null,this.isModalOpen=!0},openEditModal(t){this.modalType=t.type,this.editingRecord=t,this.isModalOpen=!0},closeModal(){this.isModalOpen=!1,this.editingRecord=null,this.defaultCategory=null},updateUserAvatar(t){this.userAvatar=t}}}),Oe="modulepreload",$e=function(t,e){return new URL(t,e).href},ne={},E=function(e,r,a){let o=Promise.resolve();if(r&&r.length>0){const l=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),g=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));o=Promise.allSettled(r.map(y=>{if(y=$e(y,a),y in ne)return;ne[y]=!0;const s=y.endsWith(".css"),_=s?'[rel="stylesheet"]':"";if(!!a)for(let b=l.length-1;b>=0;b--){const m=l[b];if(m.href===y&&(!s||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${y}"]${_}`))return;const h=document.createElement("link");if(h.rel=s?"stylesheet":Oe,s||(h.as="script"),h.crossOrigin="",h.href=y,g&&h.setAttribute("nonce",g),document.head.appendChild(h),s)return new Promise((b,m)=>{h.addEventListener("load",b),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${y}`)))})}))}function n(l){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l}return o.then(l=>{for(const u of l||[])u.status==="rejected"&&n(u.reason);return e().catch(n)})},Ae=[{path:"/welcome",name:"welcome",component:()=>E(()=>import("./Welcome-Dm_9zxW7.js"),__vite__mapDeps([0,1,2,3]),import.meta.url),meta:{title:"欢迎使用 阳阳记账",isSubPage:!0}},{path:"/login",name:"login",component:()=>E(()=>import("./Auth-zIeC9KMu.js"),__vite__mapDeps([4,1,2,5]),import.meta.url),meta:{title:"登录",isSubPage:!0}},{path:"/register",name:"register",component:()=>E(()=>import("./Auth-zIeC9KMu.js"),__vite__mapDeps([4,1,2,5]),import.meta.url),meta:{title:"注册",isSubPage:!0}},{path:"/",name:"home",component:()=>E(()=>import("./Home-m0Xb91A0.js"),__vite__mapDeps([6,7,1,2,8,9,10,11,12]),import.meta.url),meta:{title:"我的钱包"}},{path:"/calendar",name:"calendar",component:()=>E(()=>import("./Calendar-DYQO07XY.js"),__vite__mapDeps([13,7,1,2,8,9,10,11,14]),import.meta.url),meta:{title:"记账日历"}},{path:"/stats",name:"stats",component:()=>E(()=>import("./Stats-DYliK8Ld.js"),__vite__mapDeps([15,7,1,2,10,11,16]),import.meta.url),meta:{title:"财务统计"}},{path:"/settings",name:"settings",component:()=>E(()=>import("./Settings-r_90gDqm.js"),__vite__mapDeps([17,1,2,7,18,19]),import.meta.url),meta:{title:"设置"}},{path:"/settings/profile",name:"profile",component:()=>E(()=>import("./Profile-DRNvsc_Q.js"),__vite__mapDeps([20,1,2,21,22,23,24,25]),import.meta.url),meta:{title:"个人资料",isSubPage:!0}},{path:"/settings/edit-field",name:"editField",component:()=>E(()=>import("./FieldEditPage-C25xnP9y.js"),__vite__mapDeps([26,1,2,27]),import.meta.url),meta:{title:"编辑资料",isSubPage:!0}},{path:"/settings/backup",name:"backup",component:()=>E(()=>import("./Backup-ZMfWN3q1.js"),__vite__mapDeps([28,21,1,2,22,23,24,29]),import.meta.url),meta:{title:"数据备份",isSubPage:!0}},{path:"/settings/update",name:"update",component:()=>E(()=>import("./AppUpdate-C0bJ2b83.js"),__vite__mapDeps([30,23,1,2,24,18,31]),import.meta.url),meta:{title:"检查更新",isSubPage:!0}},{path:"/welcome/user-agreement",name:"userAgreement",component:()=>E(()=>import("./UserAgreement-CiIVAMm9.js"),__vite__mapDeps([32,23,1,2,24,33]),import.meta.url),meta:{title:"用户协议",isSubPage:!0}},{path:"/welcome/privacy-policy",name:"privacyPolicy",component:()=>E(()=>import("./PrivacyPolicy-DfrkW699.js"),__vite__mapDeps([34,23,1,2,24,35]),import.meta.url),meta:{title:"隐私政策",isSubPage:!0}}],H=_e({history:Se(),routes:Ae,scrollBehavior(t,e,r){return{top:0,behavior:"smooth"}}}),ae="https://spb-nl553gvni0icpw4d.supabase.opentrust.net",He="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiYW5vbiIsInJlZiI6InNwYi1ubDU1M2d2bmkwaWNwdzRkIiwiaXNzIjoic3VwYWJhc2UiLCJpYXQiOjE3NjgxMzYzMzUsImV4cCI6MjA4MzcxMjMzNX0.Iks0Kzf-L2r-jWzMG05lKcpkpjijhGbqOKkJt_cbyOU",w=De(ae,He),Be=async({email:t,phone:e,password:r,username:a})=>{if(!t&&!e)throw console.error("❌ email 和 phone 都为空！"),new Error("请提供有效的手机号或邮箱");const o={password:r,options:{data:{username:a||"",avatar:""}}};t&&(o.email=t),e&&(o.phone="+"+e);const{data:n,error:l}=await w.auth.signUp(o);if(l)throw console.error("❌ Supabase 注册错误:",l),new Error(l.message);return n},Ue=async t=>{const{email:e,phone:r,password:a}=t,o={};if(r)o.phone="+"+r;else if(e)o.email=e;else throw new Error("请提供手机号或邮箱");o.password=a;const{data:n,error:l}=await w.auth.signInWithPassword(o);if(l)throw new Error(l.message);return n},je=async()=>{const{error:t}=await w.auth.signOut();if(t)throw new Error(t.message)},qe=async()=>{const{data:t}=await w.auth.getSession();if(!t.session)return null;const{data:e,error:r}=await w.auth.getUser();if(r)throw new Error(r.message);return e==null?void 0:e.user},ie=async t=>{const e={};t.email&&(e.email=t.email),t.phone&&(e.phone="+"+t.phone),t.password&&(e.password=t.password);const r={};if(t.username&&(r.username=t.username),t.avatar&&(r.avatar=t.avatar),Object.keys(r).length>0&&(e.data=r),Object.keys(e).length===0)throw new Error("没有可更新的用户信息字段");const{data:a,error:o}=await w.auth.updateUser(e);if(o)throw new Error(o.message);return a},le=t=>{const e=/^1[3-9]\d{9}$/,r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return e.test(t)?"phone":r.test(t)?"email":null},J=Z("user",{state:()=>{const t=Q("userProfile",null);return{userProfile:t,isAuthenticated:!!t}},getters:{userInfo:t=>t.userProfile,isLoggedIn:t=>t.isAuthenticated,userAvatar:t=>{var e,r,a,o;return((o=(a=(r=(e=t.userProfile)==null?void 0:e.user)==null?void 0:r.user_metadata)==null?void 0:a.avatar)==null?void 0:o.avatar)||""},userName:t=>{var e,r,a,o,n,l;return((a=(r=(e=t.userProfile)==null?void 0:e.user)==null?void 0:r.user_metadata)==null?void 0:a.username)||((l=(n=(o=t.userProfile)==null?void 0:o.user)==null?void 0:n.email)==null?void 0:l.split("@")[0])||""},userId:t=>{var e,r;return((r=(e=t.userProfile)==null?void 0:e.user)==null?void 0:r.id)||""},userEmail:t=>{var e,r,a;return((a=(r=(e=t.userProfile)==null?void 0:e.user)==null?void 0:r.user_metadata)==null?void 0:a.email)||""},userPhone:t=>{var e,r;return((r=(e=t.userProfile)==null?void 0:e.user)==null?void 0:r.phone)||""}},actions:{async initializeAuth(){try{if(this.userProfile)return this.isAuthenticated=!0,this.userProfile;const t=await qe();return t&&(this.userProfile=t,this.isAuthenticated=!0,$("userProfile",t)),t}catch(t){return console.error("初始化认证状态失败:",t),null}},async register({username:t,account:e,password:r}){try{const a=le(e);if(!a)throw new Error("请输入有效的手机号或邮箱");const o=await Be({username:t,password:r,[a]:e});return o&&(this.userProfile=o),o}catch(a){throw console.error("注册失败:",a),a}},async login({account:t,password:e}){try{const r=le(t);if(!r)throw new Error("请输入有效的手机号或邮箱");const a=await Ue({[r]:t,password:e});return this.userProfile=a,this.isAuthenticated=!0,$("userProfile",a),a}catch(r){throw console.error("登录失败:",r),r}},async logout(){try{await je()}catch(t){console.error("退出登录失败:",t)}finally{const{useRecordsStore:t}=await E(async()=>{const{useRecordsStore:r}=await Promise.resolve().then(()=>ht);return{useRecordsStore:r}},void 0,import.meta.url);t().clearCache(),this.userProfile=null,this.isAuthenticated=!1,Le("userProfile")}},async updateProfile(t){if(!this.userProfile)throw new Error("未登录");try{const e=await ie({...t});return e&&(this.userProfile=e,this.isAuthenticated=!0),$("userProfile",e),e}catch(e){throw console.error("更新用户信息失败:",e),e}},async updateAvatar(t){await this.updateProfile({avatar:t})},async changePassword(t){if(this.userProfile)try{const e=await ie({password:t});return e&&(this.userProfile=e,this.isAuthenticated=!0),$("userProfile",e),e}catch(e){throw console.error("修改密码失败:",e),e}},async deleteAccount(){if(this.userProfile)throw await this.logout(),new Error("此功能需要集成Supabase的admin API")}}}),Ne={class:"floating-tabbar"},We={class:"tabbar-container"},Fe=["onClick"],Je={class:"tabbar-icon"},Ye=["innerHTML"],Ge=["onClick"],Ke={class:"tabbar-icon"},Xe=["innerHTML"],Qe={__name:"TabBar",setup(t){const e=re(),r=Ee(),a=pe();W(()=>a.name,g=>{g&&["home","calendar","stats","settings"].includes(g)&&e.setCurrentTab(g)},{immediate:!0});const o=[{name:"home",label:"首页",icon:'<path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>'},{name:"calendar",label:"日历",icon:'<path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"/>'}],n=[{name:"stats",label:"统计",icon:'<path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>'},{name:"settings",label:"设置",icon:'<path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>'}];function l(g){e.setCurrentTab(g),r.push({name:g})}function u(){e.openModal("expense")}return(g,y)=>(f(),v("div",Ne,[i("div",We,[(f(),v(A,null,U(o,s=>i("button",{key:s.name,class:R(["tabbar-item",{active:P(e).currentTab===s.name}]),onClick:_=>l(s.name)},[i("div",Je,[(f(),v("svg",{innerHTML:s.icon},null,8,Ye))])],10,Fe)),64)),i("button",{class:"tabbar-add-btn",onClick:u},[...y[0]||(y[0]=[i("svg",{viewBox:"0 0 24 24"},[i("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1)])]),(f(),v(A,null,U(n,s=>i("button",{key:s.name,class:R(["tabbar-item",{active:P(e).currentTab===s.name}]),onClick:_=>l(s.name)},[i("div",Ke,[(f(),v("svg",{innerHTML:s.icon},null,8,Xe))])],10,Ge)),64))])]))}};function Ze(t,e){return new Date(t,e+1,0).getDate()}function et(t,e){return new Date(t,e,1).getDay()}function tt(t){const e=new Date;return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getFullYear()===e.getFullYear()}function rt(t,e){const r=et(t,e),a=Ze(t,e),o=[];for(let n=0;n<r;n++)o.push({type:"empty",day:null});for(let n=1;n<=a;n++){const l=new Date(t,e,n);o.push({type:"day",day:n,date:l,isToday:tt(l)})}return o}function x(t){const e=t instanceof Date?t:new Date(t),r=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${r}-${a}-${o}`}const at=async t=>{const e=t.type==="expense"?-Math.abs(t.amount):Math.abs(t.amount),{data:r,error:a}=await w.from("records").insert({user_id:t.user_id,type:t.type,amount:e,category:t.category,note:t.note||"",date:t.date,image_url:t.image_url||null}).select().single();if(a)throw new Error(a.message);return r},ot=async t=>{const{error:e}=await w.from("records").delete().eq("id",t);if(e)throw new Error(e.message);return!0},st=async(t,e)=>{let r={...e};e.type&&e.amount!==void 0&&(r.amount=e.type==="expense"?-Math.abs(e.amount):Math.abs(e.amount));const{data:a,error:o}=await w.from("records").update(r).eq("id",t).select().single();if(o)throw new Error(o.message);return a},nt=async(t,e={})=>{let r=w.from("records").select("*").eq("user_id",t).order("date",{ascending:!1}).order("created_at",{ascending:!1});e.type&&(r=r.eq("type",e.type)),e.limit&&(r=r.limit(e.limit)),e.offset&&(r=r.range(e.offset,e.offset+(e.limit||20)-1));const{data:a,error:o}=await r;if(o)throw new Error(o.message);return a},it=async(t,e)=>{const r=new Date(e);r.setHours(0,0,0,0);const a=new Date(e);a.setHours(23,59,59,999);const{data:o,error:n}=await w.from("records").select("*").eq("user_id",t).gte("date",r.toISOString()).lte("date",a.toISOString()).order("created_at",{ascending:!1});if(n)throw new Error(n.message);return o},lt=async(t,e,r)=>{const a=new Date(e);a.setHours(0,0,0,0);const o=new Date(r);o.setHours(23,59,59,999);const{data:n,error:l}=await w.from("records").select("*").eq("user_id",t).gte("date",a.toISOString()).lte("date",o.toISOString()).order("date",{ascending:!1});if(l)throw new Error(l.message);return n},ct=async(t,e,r)=>{const a=new Date(e,r,1),o=new Date(e,r+1,0,23,59,59),{data:n,error:l}=await w.from("records").select("*").eq("user_id",t).gte("date",a.toISOString()).lte("date",o.toISOString()).order("date",{ascending:!1});if(l)throw new Error(l.message);return n},ut=async t=>{const e=new Date,r=e.getDay(),a=new Date(e);a.setDate(e.getDate()-r),a.setHours(0,0,0,0);const{data:o,error:n}=await w.from("records").select("*").eq("user_id",t).gte("date",a.toISOString()).order("date",{ascending:!1});if(n)throw new Error(n.message);return o},dt=async(t,e=20)=>{const{data:r,error:a}=await w.from("records").select("*").eq("user_id",t).order("created_at",{ascending:!1}).limit(e);if(a)throw new Error(a.message);return r},mt=async t=>{const{data:e,error:r}=await w.from("records").select("type, amount").eq("user_id",t);if(r)throw new Error(r.message);const a=e.filter(l=>l.type==="income").reduce((l,u)=>l+u.amount,0),o=e.filter(l=>l.type==="expense").reduce((l,u)=>l+Math.abs(u.amount),0),n=a-o;return{totalIncome:a,totalExpense:o,totalBalance:n,recordCount:e.length}},ve=Z("records",{state:()=>({records:[],categories:{expense:["餐饮","交通","购物","娱乐","医疗","其他"],income:["工资","投资","礼金","其他"]},loading:!1,error:null}),getters:{totalBalance:t=>t.records.reduce((e,r)=>e+r.amount,0),totalIncome:t=>t.records.filter(e=>e.type==="income").reduce((e,r)=>e+r.amount,0),totalExpense:t=>t.records.filter(e=>e.type==="expense").reduce((e,r)=>e+Math.abs(r.amount),0),recordsByDate:t=>{const e={};return t.records.forEach(r=>{const a=x(r.date);e[a]||(e[a]=[]),e[a].push(r)}),Object.keys(e).forEach(r=>{e[r].sort((a,o)=>new Date(o.createdAt)-new Date(a.createdAt))}),e},recordsByCategory:t=>{const e={expense:{},income:{}};return t.records.forEach(r=>{e[r.type][r.category]||(e[r.type][r.category]=[]),e[r.type][r.category].push(r)}),e},expenseByCategory:t=>{const e={};return t.records.filter(r=>r.type==="expense").forEach(r=>{e[r.category]||(e[r.category]=0),e[r.category]+=Math.abs(r.amount)}),e},recentRecords:t=>[...t.records].sort((e,r)=>new Date(r.createdAt)-new Date(e.createdAt)).slice(0,20),thisWeekRecords:t=>{const e=new Date,r=e.getDay(),a=new Date(e);return a.setDate(e.getDate()-r),a.setHours(0,0,0,0),t.records.filter(o=>new Date(o.date)>=a)}},actions:{async fetchRecords(t,e={}){try{this.loading=!0,this.error=null,this.records=await nt(t,e)}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},async fetchRecordsByDate(t,e){try{this.loading=!0,this.error=null,this.records=await it(t,e)}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},async fetchRecordsByDateRange(t,e,r){try{this.loading=!0,this.error=null,this.records=await lt(t,e,r)}catch(a){throw this.error=a.message,a}finally{this.loading=!1}},async fetchMonthlyRecords(t,e,r){try{this.loading=!0,this.error=null,this.records=await ct(t,e,r)}catch(a){throw this.error=a.message,a}finally{this.loading=!1}},async fetchThisWeekRecords(t){try{this.loading=!0,this.error=null,this.records=await ut(t)}catch(e){throw this.error=e.message,e}finally{this.loading=!1}},async fetchRecentRecords(t,e=20){try{this.loading=!0,this.error=null,this.records=await dt(t,e)}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},async addRecord(t,e){try{this.loading=!0,this.error=null;const r=await at({...e,user_id:t});return this.records.unshift(r),r}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},async deleteRecord(t){try{this.loading=!0,this.error=null,await ot(t);const e=this.records.findIndex(r=>r.id===t);return e!==-1&&this.records.splice(e,1),!0}catch(e){throw this.error=e.message,e}finally{this.loading=!1}},async updateRecord(t,e){try{this.loading=!0,this.error=null;const r=await st(t,e),a=this.records.findIndex(o=>o.id===t);return a!==-1&&(this.records[a]=r),r}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},clearCache(){this.records=[],this.error=null},async fetchStats(t){try{return this.loading=!0,await mt(t)}catch(e){throw this.error=e.message,e}finally{this.loading=!1}}}}),ht=Object.freeze(Object.defineProperty({__proto__:null,useRecordsStore:ve},Symbol.toStringTag,{value:"Module"})),B=(t,e)=>{const r=t.__vccOpts||t;for(const[a,o]of e)r[a]=o;return r},pt={class:"month-selector"},ft={class:"current-month"},gt={class:"calendar-grid"},yt={class:"weekdays"},vt={class:"days"},wt=["onClick"],bt={__name:"DateSelectModal",props:{show:{type:Boolean,default:!1},modelValue:{type:[String,Date],default:null},maxDate:{type:[String,Date],default:()=>new Date}},emits:["update:show","update:modelValue","confirm","cancel"],setup(t,{emit:e}){const r=t,a=e,o=z(r.modelValue?new Date(r.modelValue):new Date),n=z(r.modelValue?x(r.modelValue):null),l=["日","一","二","三","四","五","六"],u=I(()=>o.value.getFullYear()),g=I(()=>o.value.getMonth()),y=I(()=>`${u.value}年 ${g.value+1}月`),s=I(()=>r.maxDate?x(r.maxDate):null),_=I(()=>rt(u.value,g.value)),p=D=>D.type!=="day"||!n.value?!1:x(D.date)===n.value,h=D=>D.type!=="day"||!s.value?!1:x(D.date)>s.value;function b(){g.value===0?o.value=new Date(u.value-1,11,1):o.value=new Date(u.value,g.value-1,1)}function m(){g.value===11?o.value=new Date(u.value+1,0,1):o.value=new Date(u.value,g.value+1,1)}function c(D){D.type==="day"&&!h(D)&&(n.value=x(D.date),a("update:modelValue",n.value))}function d(){n.value&&(a("update:modelValue",n.value),a("confirm",n.value)),a("update:show",!1)}function C(){a("cancel"),a("update:show",!1)}return W(()=>r.show,D=>{if(D)if(r.modelValue){const S=new Date(r.modelValue);o.value=S,n.value=x(S)}else o.value=new Date,n.value=null}),(D,S)=>(f(),j(te,{to:"body"},[V(fe,{name:"fade"},{default:q(()=>[t.show?(f(),v("div",{key:0,class:"date-select-modal-overlay",onClick:C},[i("div",{class:"date-select-modal",onClick:S[0]||(S[0]=ee(()=>{},["stop"]))},[i("div",{class:"modal-header"},[i("button",{class:"header-btn cancel-btn",onClick:C},"取消"),S[1]||(S[1]=i("div",{class:"header-title"},"选择日期",-1)),i("button",{class:"header-btn confirm-btn",onClick:d},"确认")]),i("div",pt,[i("button",{class:"month-nav-btn",onClick:b},[...S[2]||(S[2]=[i("svg",{viewBox:"0 0 24 24"},[i("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})],-1)])]),i("div",ft,T(y.value),1),i("button",{class:"month-nav-btn",onClick:m},[...S[3]||(S[3]=[i("svg",{viewBox:"0 0 24 24"},[i("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})],-1)])])]),i("div",gt,[i("div",yt,[(f(),v(A,null,U(l,M=>i("div",{key:M,class:"weekday"},T(M),1)),64))]),i("div",vt,[(f(!0),v(A,null,U(_.value,(M,be)=>(f(),v("div",{key:be,class:R(["day-cell",{empty:M.type==="empty",today:M.isToday,selected:p(M),disabled:h(M)}]),onClick:dr=>c(M)},T(M.day),11,wt))),128))])])])])):L("",!0)]),_:1})]))}},_t=B(bt,[["__scopeId","data-v-90be798d"]]),St={class:"date-picker-wrapper"},Dt={__name:"DatePicker",props:{modelValue:{type:String,default:""},maxDate:{type:[String,Date],default:()=>new Date}},emits:["update:modelValue","confirm"],setup(t,{emit:e}){const r=t,a=e,o=z(null),n=z(!1),l=I({get(){return r.modelValue?r.modelValue:""},set(){}});function u(){n.value=!0}function g(s){a("update:modelValue",s)}function y(s){a("update:modelValue",s),a("confirm",s)}return(s,_)=>(f(),v("div",St,[G(i("input",{ref_key:"inputRef",ref:o,"onUpdate:modelValue":_[0]||(_[0]=p=>l.value=p),readonly:"",class:"date-picker-input",onClick:u},null,512),[[K,l.value]]),(f(),v("svg",{class:"calendar-icon",viewBox:"0 0 24 24",onClick:u},[..._[2]||(_[2]=[i("path",{d:"M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm-8 4H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"},null,-1)])])),V(_t,{show:n.value,"onUpdate:show":_[1]||(_[1]=p=>n.value=p),"model-value":t.modelValue,"max-date":t.maxDate,"onUpdate:modelValue":g,onConfirm:y},null,8,["show","model-value","max-date"])]))}},Et=B(Dt,[["__scopeId","data-v-74b59010"]]),kt={key:0,class:"toast-icon",viewBox:"0 0 24 24"},Mt={key:1,class:"toast-icon",viewBox:"0 0 24 24"},Pt={key:2,class:"toast-icon",viewBox:"0 0 24 24"},It={class:"toast-message"},Vt={__name:"Toast",props:{message:{type:String,required:!0},type:{type:String,default:"success",validator:t=>["success","warning","error"].includes(t)},visible:{type:Boolean,default:!1}},setup(t){return(e,r)=>(f(),j(te,{to:"body"},[V(fe,{name:"toast"},{default:q(()=>[t.visible?(f(),v("div",{key:0,class:R(["toast-container",[`toast-${t.type}`]])},[t.type==="success"?(f(),v("svg",kt,[...r[0]||(r[0]=[i("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"},null,-1)])])):t.type==="error"?(f(),v("svg",Mt,[...r[1]||(r[1]=[i("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"},null,-1)])])):t.type==="warning"?(f(),v("svg",Pt,[...r[2]||(r[2]=[i("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"},null,-1)])])):L("",!0),i("span",It,T(t.message),1)],2)):L("",!0)]),_:1})]))}},xt=B(Vt,[["__scopeId","data-v-41b08afd"]]);let ce=null,N=null,O=null;function zt(){return ce||(N=document.createElement("div"),N.id="toast-container",document.body.appendChild(N),O=ge({message:"",type:"success",visible:!1,timer:null}),ce=ye({render(){return ke(xt,{message:O.message,type:O.type,visible:O.visible})}}).mount(N)),O}function Y(t,e="success",r=2e3){const a=zt();return a.timer&&clearTimeout(a.timer),a.message=t,a.type=e,a.visible=!0,r>0&&(a.timer=setTimeout(()=>{a.visible=!1},r)),{close:()=>{a.timer&&clearTimeout(a.timer),a.visible=!1}}}const k={success(t,e){return Y(t,"success",e)},warning(t,e){return Y(t,"warning",e)},error(t,e){return Y(t,"error",e)}},Ct=async t=>{const e=J();if(!e.userId)throw new Error("用户未登录，无法上传文件");if(!t||!(t instanceof File))return"";const r=e.userId,a=t.name,o=a.split(/[/\\]/).pop()??a,n=`${r}/${Date.now()}_${o}`,{data:l,error:u}=await w.storage.from("gzynb").upload(n,t,{cacheControl:"3600",upsert:!1});if(u)throw console.error("文件上传失败：",u),new Error(u.message);if(!l)throw new Error("文件上传成功，但未返回文件路径");return`${ae}/storage/v1/object/public/${l.fullPath}`},Rt=async t=>{t=t.replace(`${ae}/storage/v1/object/public/gzynb/`,"");const{error:e}=await w.storage.from("gzynb").remove([t]);if(e)throw new Error(e.message)},Tt={class:"image-upload-container"},Lt={key:0,class:"image-preview-wrapper"},Ot={class:"upload-hint"},$t={__name:"ImageUpload",props:{modelValue:{type:String,default:""},maxSize:{type:Number,default:5}},emits:["update:modelValue"],setup(t,{emit:e}){const r=t,a=e,o=z(r.modelValue?[{url:r.modelValue,isImage:!0}]:[]),n=z(null),l=J(),u=p=>["image/jpeg","image/png","image/jpg"].includes(p.type)?!0:(k.warning("只支持 JPG、PNG 格式的图片"),!1),g=async p=>{if(!l.userId){k.warning("请先到设置页 -> 个人资料 -> 登录");return}p instanceof Array&&(p=p[0]),p.status="uploading";try{const h=await y(p.file,800,.6);if(!h)throw k.error("图片压缩失败"),p.status="failed",new Error("图片压缩失败，未生成有效文件");const b=await Ct(h);a("update:modelValue",b),p.status="success",p.data=b,o.value=[{url:b,isImage:!0}],k.success("图片添加成功")}catch(h){p.status="failed",o.value=[],console.error("图片上传失败:",h),k.error(`图片上传失败：${h.message}`)}},y=(p,h,b)=>{if(p)return new Promise((m,c)=>{new xe(p,{quality:b,maxWidth:h,maxHeight:800,convertSize:1e6,checkOrientation:!0,success(d){const C=new File([d],d.name,{type:d.type});m(C)},error(d){c(new Error(`图片压缩失败: ${d.message}`))}})})},s=()=>{k.error(`图片大小不能超过 ${r.maxSize}MB`)},_=async()=>{const p=Pe({message:"删除中...",forbidClick:!0});try{await Rt(o.value[0].url),a("update:modelValue",""),o.value=[],p.close(),Ie("图片已删除")}catch(h){p.close(),console.error("删除图片失败:",h),Ve("删除图片失败")}};return(p,h)=>(f(),v(A,null,[i("div",Tt,[V(P(Me),{ref_key:"uploaderRef",ref:n,modelValue:o.value,"onUpdate:modelValue":h[0]||(h[0]=b=>o.value=b),"after-read":g,"before-read":u,"max-size":t.maxSize*1024*1024,onOversize:s,"max-count":1,accept:"image/*",class:"hidden-uploader"},{default:q(()=>[...h[1]||(h[1]=[i("div",{class:"upload-button"},[i("svg",{viewBox:"0 0 24 24"},[i("path",{d:"M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"})]),i("span",null,"添加图片")],-1)])]),_:1},8,["modelValue","max-size"]),t.modelValue?(f(),v("div",Lt,[V(P(X),{type:"warning",size:"small",icon:"delete",class:"delete-image-btn",onClick:ee(_,["stop"])})])):L("",!0)]),i("p",Ot,"支持 JPG、PNG 格式，最大 "+T(t.maxSize)+"MB",1)],64))}},At=B($t,[["__scopeId","data-v-887ecc52"]]),Ht={class:"modal-content"},Bt={class:"modal-header"},Ut={class:"modal-title"},jt={class:"type-toggle"},qt={class:"form-group"},Nt={class:"amount-input-wrapper"},Wt={class:"form-group"},Ft={class:"category-grid"},Jt=["onClick"],Yt=["innerHTML"],Gt={class:"category-name"},Kt={class:"form-group"},Xt={class:"form-group"},Qt={class:"form-group"},Zt={class:"modal-actions"},er={__name:"AddRecordModal",setup(t){const e=re(),r=J(),a=ve(),o=z(null),n=z(!1),l=z(!1),u=I(()=>e.editingRecord!==null),g=I(()=>u.value?"编辑记录":"添加记录"),y=[{name:"餐饮",icon:'<path d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"/>',type:"expense"},{name:"交通",icon:'<path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"/>',type:"expense"},{name:"购物",icon:'<path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>',type:"expense"},{name:"娱乐",icon:'<path d="M21 5.71v12.58c0 1.45-1.38 2.58-2.91 2.58H2.91C1.38 20.87 0 19.74 0 18.29V5.71C0 4.26 1.38 3.13 2.91 3.13h15.18C19.62 3.13 21 4.26 21 5.71zM12 17c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5z"/>',type:"expense"},{name:"医疗",icon:'<path d="M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 11h-4v4h-4v-4H6v-4h4V6h4v4h4v4z"/>',type:"expense"},{name:"工资",icon:'<path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>',type:"income"},{name:"投资",icon:'<path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/>',type:"income"},{name:"礼金",icon:'<path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"/>',type:"income"},{name:"其他",icon:'<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>',type:"both"}],s=ge({type:"expense",amount:"",category:"餐饮",note:"",date:x(new Date),image:""});I(()=>y.filter(m=>m.type===s.type||m.type==="both")),W(()=>e.isModalOpen,m=>{if(m)if(u.value){const c=e.editingRecord;s.type=c.type,s.category=c.category,s.amount=Math.abs(c.amount),s.note=c.note||"",s.date=c.date.split("T")[0],s.image=c.image_url||""}else{if(s.type=e.modalType,e.defaultCategory)s.category=e.defaultCategory;else{const c=y.find(d=>d.type===s.type||d.type==="both");s.category=(c==null?void 0:c.name)||"餐饮"}s.amount="",s.note="",s.date=x(new Date),s.image=""}}),W(()=>s.type,m=>{const c=y.find(d=>d.type===m||d.type==="both");s.category=(c==null?void 0:c.name)||"餐饮"});function _(m){s.category=m}function p(m){const c=m.target.value;if(c===""||c===null||c===void 0){s.amount="";return}let d=String(c);if(d.includes(".")){const C=d.split("."),D=C[0]||"0",S=C[1]||"";if(S.length>2){const M=`${D}.${S.substring(0,2)}`;m.target.value=M,s.amount=M}else s.amount=d}else s.amount=d}async function h(){if(!r.userId){k.warning("请先到设置页 -> 个人资料 -> 登录");return}if(!s.amount||s.amount<=0){k.warning("请输入有效金额");return}if(s.amount<.01){k.warning("金额不能低于 0.01 元");return}n.value=!0;try{if(u.value){const m=e.editingRecord.date.split("T")[1];await a.updateRecord(e.editingRecord.id,{type:s.type,amount:s.amount,category:s.category,note:s.note,date:`${s.date}T${m}`,image_url:s.image}),k.success("记录更新成功")}else{const m=new Date,c=new Date(s.date);c.setHours(m.getHours(),m.getMinutes(),m.getSeconds(),m.getMilliseconds()),await a.addRecord(r.userId,{type:s.type,amount:s.amount,category:s.category,note:s.note,date:c.toISOString(),image_url:s.image}),k.success("记录添加成功")}e.closeModal()}catch(m){k.error("操作失败: "+m.message),console.error("提交记录失败:",m)}finally{n.value=!1}}async function b(){u.value&&(l.value=!0,ze({title:"删除记录",message:"确定要清除记录吗？",confirmButtonColor:"#ff8a5b",cancelButtonColor:"#8a8a8a"}).then(async()=>{await a.deleteRecord(e.editingRecord.id),k.success("记录删除成功"),l.value=!1,e.closeModal()}).catch(m=>{l.value=!1,m!=="cancel"&&(console.error("删除记录失败:",m),k.error("删除失败: "+m.message))}))}return(m,c)=>(f(),j(te,{to:"body"},[P(e).isModalOpen?(f(),v("div",{key:0,class:"modal-overlay",onClick:c[7]||(c[7]=ee((...d)=>P(e).closeModal&&P(e).closeModal(...d),["self"]))},[i("div",Ht,[i("div",Bt,[i("div",Ut,T(g.value),1),i("button",{class:"modal-close-btn",onClick:c[0]||(c[0]=(...d)=>P(e).closeModal&&P(e).closeModal(...d))},[...c[8]||(c[8]=[i("svg",{viewBox:"0 0 24 24"},[i("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])])]),i("div",jt,[i("button",{class:R(["type-btn expense",{active:s.type==="expense"}]),onClick:c[1]||(c[1]=d=>s.type="expense")},"支出",2),i("button",{class:R(["type-btn income",{active:s.type==="income"}]),onClick:c[2]||(c[2]=d=>s.type="income")},"收入",2)]),i("div",qt,[c[10]||(c[10]=i("label",{class:"form-label"},"金额",-1)),i("div",Nt,[c[9]||(c[9]=i("span",{class:"currency-symbol"},"¥",-1)),G(i("input",{ref_key:"amountInput",ref:o,"onUpdate:modelValue":c[3]||(c[3]=d=>s.amount=d),type:"number",class:"form-input amount-input",placeholder:"0.00",step:"0.01",min:"0.00",onInput:p},null,544),[[K,s.amount]])])]),i("div",Wt,[c[11]||(c[11]=i("label",{class:"form-label"},"分类",-1)),i("div",Ft,[(f(),v(A,null,U(y,d=>i("button",{key:d.name,class:R(["category-option",{selected:s.category===d.name}]),onClick:C=>_(d.name)},[(f(),v("svg",{viewBox:"0 0 24 24",innerHTML:d.icon},null,8,Yt)),i("div",Gt,T(d.name),1)],10,Jt)),64))])]),i("div",Kt,[c[12]||(c[12]=i("label",{class:"form-label"},"备注",-1)),G(i("input",{"onUpdate:modelValue":c[4]||(c[4]=d=>s.note=d),type:"text",class:"form-input",placeholder:"添加备注..."},null,512),[[K,s.note]])]),i("div",Xt,[c[13]||(c[13]=i("label",{class:"form-label"},"日期",-1)),V(Et,{modelValue:s.date,"onUpdate:modelValue":c[5]||(c[5]=d=>s.date=d)},null,8,["modelValue"])]),i("div",Qt,[c[14]||(c[14]=i("label",{class:"form-label"},"记录图片（可选）",-1)),V(At,{modelValue:s.image,"onUpdate:modelValue":c[6]||(c[6]=d=>s.image=d),"max-size":5},null,8,["modelValue"])]),i("div",Zt,[u.value?(f(),j(P(X),{key:0,loading:l.value,disabled:n.value,class:"delete-btn",onClick:b},{default:q(()=>[...c[15]||(c[15]=[se("删除记录",-1)])]),_:1},8,["loading","disabled"])):L("",!0),V(P(X),{loading:n.value,disabled:l.value,class:"submit-btn",onClick:h},{default:q(()=>[se(T(u.value?"保存修改":"保存记录"),1)]),_:1},8,["loading","disabled"])])])])):L("",!0)]))}},tr=B(er,[["__scopeId","data-v-beb545c1"]]),rr={__name:"App",setup(t){const e=pe(),r=re(),a=J(),o=I(()=>{var n;return(n=e.meta)==null?void 0:n.isSubPage});return Ce(async()=>{r.initTheme(),await a.initializeAuth()}),(n,l)=>{const u=Re("router-view");return f(),v("div",{id:"app",class:R({"dark-theme":P(r).isDark,"hide-tabbar":o.value})},[l[0]||(l[0]=i("div",{class:"bg-decoration bg-decoration-1"},null,-1)),l[1]||(l[1]=i("div",{class:"bg-decoration bg-decoration-2"},null,-1)),l[2]||(l[2]=i("div",{class:"bg-decoration bg-decoration-3"},null,-1)),V(u),o.value?L("",!0):(f(),j(Qe,{key:0})),V(tr)],2)}}},ar=B(rr,[["__scopeId","data-v-72179003"]]);let ue=0;const or=2e3;let de=!1;function sr(t){typeof window>"u"||de||(de=!0,console.log("初始化返回键拦截"),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",me):me())}function me(){window.plus?window.plusReady?he():document.addEventListener("plusready",he):(console.log("非 Plus 环境，使用浏览器返回拦截"),nr())}function he(){console.log("Plus 环境返回键处理已启用"),plus.key.addEventListener("backbutton",ir,!1),console.log("系统侧滑返回已保留")}function nr(){window.addEventListener("popstate",t=>{console.log("浏览器 popstate 触发，当前路由:",H.currentRoute.value.path),we()&&window.history.length<=1&&(t.preventDefault(),lr())})}function ir(){if(console.log("Plus backbutton 触发，当前路由:",H.currentRoute.value.path),we()){const t=Date.now();t-ue<or?plus.runtime.quit():(ue=t,cr())}else H.back()}function we(){const t=H.currentRoute.value.path;return t==="/"||t==="/home"}function lr(){confirm("确定要退出应用吗？")&&(window.plus?plus.runtime.quit():console.log("浏览器环境，无法退出应用"))}function cr(){const t=document.createElement("div");if(t.textContent="再按一次退出应用",t.style.cssText=`
		position: fixed;
		bottom: 100px;
		left: 50%;
		transform: translateX(-50%);
		background: rgba(0, 0, 0, 0.7);
		color: white;
		padding: 12px 24px;
		border-radius: 8px;
		font-size: 14px;
		z-index: 10000;
		animation: fadeInOut 2000ms ease-in-out;
		pointer-events: none;
	`,!document.getElementById("toast-animation-style")){const e=document.createElement("style");e.id="toast-animation-style",e.textContent=`
			@keyframes fadeInOut {
				0%, 100% { opacity: 0; }
				10%, 90% { opacity: 1; }
			}
		`,document.head.appendChild(e)}document.body.appendChild(t),setTimeout(()=>{t.parentNode&&document.body.removeChild(t)},2e3)}const oe=ye(ar),ur=Te();oe.use(ur);oe.use(H);oe.mount("#app");sr();H.afterEach(()=>{});export{B as _,ve as a,re as b,rt as c,hr as d,Ct as e,x as f,Q as g,k as m,$ as s,J as u};
