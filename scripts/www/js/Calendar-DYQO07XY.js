import{_ as B,a as R,u as T,f as v,c as F,m as I}from"./index-BsLNy1A6.js";import{_ as $}from"./Header-Bt5F6yjk.js";import{T as Y}from"./TransactionItem-B9TJhCCc.js";import{O as z}from"./Overlay-B0sPJSDj.js";import{j as c,i as m,w as O,J as N,f as r,g as t,l as k,t as h,F as _,r as y,o as n,n as V,k as j}from"./vendor-CLLCb1yY.js";const E={class:"page fade-in-up"},J={class:"container"},U={class:"month-selector"},W={class:"current-month"},q={class:"calendar-grid"},A={class:"weekdays"},G={class:"days"},H=["onClick"],K={class:"selected-date-section"},P={class:"section-header"},Q={class:"section-title"},X={key:0},Z={key:1,class:"glass-card"},ee={__name:"Calendar",setup(te){const i=R(),p=T(),w=c(()=>i.loading),d=m(new Date().getFullYear()),o=m(new Date().getMonth()),l=m(v(new Date)),D=["日","一","二","三","四","五","六"],M=c(()=>`${d.value}年 ${o.value+1}月`),S=c(()=>{const a=new Date(l.value),s=new Date;return a.getDate()===s.getDate()&&a.getMonth()===s.getMonth()&&a.getFullYear()===s.getFullYear()?"今天的记录":`${l.value} 的记录`}),C=c(()=>{const a=F(d.value,o.value),s=new Set(i.records.map(e=>v(e.date)));return a.map(e=>{if(e.type==="day"){const u=v(e.date);return{...e,hasRecord:s.has(u),dateStr:u}}return e})}),f=c(()=>i.records.filter(a=>v(a.date)===l.value));async function g(){if(p.userId)try{await i.fetchMonthlyRecords(p.userId,d.value,o.value)}catch(a){console.error("加载月度记录失败:",a),I.error("加载记录失败",a.message)}}O([d,o],()=>{g()}),N(()=>{g()});function L(){o.value===0?(o.value=11,d.value--):o.value--}function b(){o.value===11?(o.value=0,d.value++):o.value++}function x(a){a.type==="day"&&a.dateStr&&(l.value=a.dateStr)}return(a,s)=>(n(),r(_,null,[t("div",E,[k($,{title:"记账日历"}),t("div",J,[t("div",U,[t("button",{class:"month-nav-btn",onClick:L},[...s[0]||(s[0]=[t("svg",{viewBox:"0 0 24 24"},[t("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})],-1)])]),t("div",W,h(M.value),1),t("button",{class:"month-nav-btn",onClick:b},[...s[1]||(s[1]=[t("svg",{viewBox:"0 0 24 24"},[t("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})],-1)])])]),t("div",q,[t("div",A,[(n(),r(_,null,y(D,e=>t("div",{key:e,class:"weekday"},h(e),1)),64))]),t("div",G,[(n(!0),r(_,null,y(C.value,(e,u)=>(n(),r("div",{key:u,class:V(["day-cell",{empty:e.type==="empty",today:e.isToday,"has-record":e.hasRecord,selected:l.value===e.dateStr}]),onClick:ae=>x(e)},h(e.day),11,H))),128))])]),t("div",K,[t("div",P,[t("div",Q,h(S.value),1)]),s[3]||(s[3]=t("div",{style:{"margin-bottom":"16px"}},null,-1)),f.value.length>0?(n(),r("div",X,[(n(!0),r(_,null,y(f.value,e=>(n(),j(Y,{key:e.id,record:e},null,8,["record"]))),128))])):(n(),r("div",Z,[...s[2]||(s[2]=[t("div",{class:"empty-state"},[t("p",null,"这一天没有记录")],-1)])]))])])]),k(z,{show:w.value},null,8,["show"])],64))}},le=B(ee,[["__scopeId","data-v-fac71f00"]]);export{le as default};
