import{i as g,y as L,j as d,J as F,f as w,l as v,g as t,k as y,p as S,m as U,h as C,U as G,H as p,C as z,D as B,E as u,u as R,o as m,G as D}from"./vendor-CLLCb1yY.js";import{_ as j,u as J,m as i,e as O}from"./index-Bwo_eupb.js";import{F as f}from"./FormSection-DLh0ZiHI.js";import{B as q}from"./BackNavBar-eYKXhRhQ.js";const $={class:"profile-page"},W={class:"profile-container"},K={class:"avatar-section"},Q={class:"avatar-wrapper"},X={__name:"Profile",setup(Y){const h=R(),s=J(),l=g([]),c=g(""),r=L({username:"",email:"",phone:""}),k=d(()=>[{icon:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z",label:"ç”¨æˆ·å",value:r.username,field:"username"},{icon:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z",label:"é‚®ç®±",value:r.email,field:"email"},{icon:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z",label:"æ‰‹æœºå·ç ",value:r.phone,field:"phone"}]),b=d(()=>[{icon:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z",label:"é€€å‡ºç™»å½•",field:"logout"}]),V=d(()=>[{icon:"M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8v14z",label:"ç™»å½•",field:"login"}]),_=e=>{h.push({path:"/settings/edit-field",query:{field:e}})},M=e=>["image/jpeg","image/png","image/jpg"].includes(e.type)?!0:(i.warning("åªæ”¯æŒ JPGã€PNG æ ¼å¼çš„å›¾ç‰‡"),!1),x=async e=>{e instanceof Array&&(e=e[0]),e.status="uploading";try{const a=await A(e.file);if(!a)throw i.error("å›¾ç‰‡å‹ç¼©å¤±è´¥"),e.status="failed",new Error("å›¾ç‰‡å‹ç¼©å¤±è´¥ï¼Œæœªç”Ÿæˆæœ‰æ•ˆæ–‡ä»¶");const o=await O(a);c.value=o;const n=await s.updateAvatar({avatar:c.value});i.success("å¤´åƒä¸Šä¼ æˆåŠŸï¼"),e.status="success",e.data=o}catch(a){e.status="failed",l.value=[],console.log("ğŸš€ ~ afterRead ~ error:",a),i.error(`å¤´åƒä¸Šä¼ å¤±è´¥ï¼š${a.message}`)}},P=()=>{i.error("å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡ 5MB")},E=async()=>{try{if(await p({title:"åˆ é™¤å¤´åƒ",message:"ç¡®å®šè¦åˆ é™¤å¤´åƒå—ï¼Ÿ",confirmButtonColor:"#ff8a5b",cancelButtonColor:"#8a8a8a"})){l.value=[],c.value="";const a=z({message:"åˆ é™¤ä¸­...",forbidClick:!0});try{await s.updateAvatar({avatar:""}),a.close(),B("å¤´åƒåˆ é™¤æˆåŠŸ")}catch(o){a.close(),console.error("åˆ é™¤å¤´åƒå¤±è´¥:",o),u("åˆ é™¤å¤´åƒå¤±è´¥")}}}catch(e){e!=="cancel"&&(console.error("åˆ é™¤å¤´åƒå¤±è´¥:",e),u("åˆ é™¤å¤´åƒå¤±è´¥"))}},A=async e=>{if(e)return new Promise((a,o)=>{new D(e,{quality:.6,maxWidth:800,maxHeight:800,convertSize:1e6,checkOrientation:!0,success(n){const H=new File([n],n.name,{type:n.type});a(H)},error(n){o(new Error(`å›¾ç‰‡å‹ç¼©å¤±è´¥: ${n.message}`))}})})},I=async()=>{try{if(await p({title:"é€€å‡ºç™»å½•",message:"ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ",confirmButtonColor:"#ff8a5b",cancelButtonColor:"#8a8a8a"})){l.value=[],c.value="",r.username="",r.email="",r.phone="";const a=z({message:"é€€å‡ºä¸­...",forbidClick:!0});try{await s.logout(),a.close(),B("é€€å‡ºç™»å½•æˆåŠŸ")}catch(o){a.close(),console.error("é€€å‡ºç™»å½•å¤±è´¥:",o),u("é€€å‡ºç™»å½•å¤±è´¥")}}}catch(e){e!=="cancel"&&(console.error("é€€å‡ºç™»å½•å¤±è´¥:",e),u("é€€å‡ºç™»å½•å¤±è´¥"))}},N=async()=>{try{await p({title:"ç™»å½•",message:"ç¡®å®šè¦å»ç™»å½•å—ï¼Ÿ",confirmButtonColor:"#ff8a5b",cancelButtonColor:"#8a8a8a"})&&h.push("/welcome")}catch{}},T=()=>{s.userId&&(l.value=s.userAvatar?[{url:s.userAvatar}]:[],c.value=s.userAvatar?s.userAvatar:"",r.username=s.userName?s.userName:"",r.email=s.userEmail?s.userEmail:"",r.phone=s.userPhone?s.userPhone:"")};return F(()=>{T()}),(e,a)=>(m(),w("div",$,[v(q,{title:"ä¸ªäººèµ„æ–™"}),t("div",W,[t("div",K,[t("div",Q,[a[3]||(a[3]=t("div",{class:"avatar-glow"},null,-1)),v(C(G),{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=o=>l.value=o),"after-read":x,"before-read":M,"max-size":5*1024*1024,onOversize:P,class:"avatar-uploader","max-count":1,accept:"image/*"},{default:U(()=>[...a[1]||(a[1]=[t("div",{class:"my-upload"},[t("svg",{class:"avatar-icon",viewBox:"0 0 24 24"},[t("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})]),t("div",null,"ç‚¹å‡»ä¸Šä¼ ")],-1)])]),_:1},8,["modelValue"]),l.value.length>0?(m(),w("div",{key:0,class:"custom-delete-btn",onClick:E},[...a[2]||(a[2]=[t("svg",{viewBox:"0 0 24 24"},[t("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1)])])):S("",!0)]),a[4]||(a[4]=t("p",{class:"avatar-hint"},"ç‚¹å‡»ä¸Šä¼ å¤´åƒï¼Œæ”¯æŒ JPGã€PNG æ ¼å¼ï¼Œæœ€å¤§ 5MB",-1))]),v(f,{items:k.value,title:"ä¸ªäººèµ„æ–™è®¾ç½®",onClick:_},null,8,["items"]),C(s).userId?(m(),y(f,{key:0,items:b.value,title:"é€€å‡ºç™»å½•",onClick:I},null,8,["items"])):(m(),y(f,{key:1,items:V.value,title:"ç™»å½•",onClick:N},null,8,["items"]))])]))}},te=j(X,[["__scopeId","data-v-d00f0ed2"]]);export{te as default};
